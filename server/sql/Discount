DELIMITER $$

CREATE PROCEDURE ApplyDiscountByGenre(IN p_genre VARCHAR(255), IN p_discount_rate DECIMAL(5,2))
BEGIN
    UPDATE games
    SET price = price * (1 - p_discount_rate)
    WHERE genre = p_genre;
END$$

DELIMITER ;

CREATE TABLE price_change_log (
    id INT AUTO_INCREMENT PRIMARY KEY,
    game_id INT,
    old_price DECIMAL(10,2),
    new_price DECIMAL(10,2),
    changed_at DATETIME
);

DELIMITER $$

CREATE TRIGGER log_price_change
AFTER UPDATE ON games
FOR EACH ROW
BEGIN
    IF NEW.price <> OLD.price THEN
        INSERT INTO price_change_log (game_id, old_price, new_price, changed_at)
        VALUES (OLD.id, OLD.price, NEW.price, NOW());
    END IF;
END$$

DELIMITER ;